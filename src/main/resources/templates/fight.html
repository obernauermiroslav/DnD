<!DOCTYPE html>
<html>
<head>
  <title>Welcome to the arena</title>
  <link rel="stylesheet" href="/css/fight.css">
</head>
<body>
<h1>Welcome to the arena</h1>
<div id="buttons">
  <button onclick="location.href='/readmeFight'" style="cursor: url(https://cur.cursors-4u.net/games/gam-11/gam1070.png), auto !important;">Readme</button>
  <button class="btn btn-secondary" onclick="location.href='/hero'">Hero</button>
  <form id="healForm" action="/heal" method="post">
    <button type="submit" class="btn btn-secondary" data-effect="Heals you up to 30 health">Use Healing potion</button>
    <input type="hidden" name="heroId" value="1" />
  </form>
  <button type="button" class="btn btn-secondary" onclick="toggleFormVisibility()">Spells</button>
  <form class="spellCast" action="/healing" method="post" style="display: none;">
    <button id="healing" class="btn btn-secondary" type="submit" data-effect="Heals you up to 25 health">Healing</button>
    <input type="hidden" name="heroId" value="1" />
  </form>
  <form class="spellCast" action="/weakness" method="post" style="display: none;">
    <button id="weakness" class="btn btn-secondary" type="submit" data-effect="Weakens the enemy's attack by 3">Weakness</button>
    <input type="hidden" name="heroId" value="1" />
  </form>
  <form class="spellCast" action="/sunder_armor" method="post" style="display: none;">
    <button id="sunder_armor" class="btn btn-secondary" type="submit" data-effect="Reduces enemy's defense by 3">Sunder Armor</button>
    <input type="hidden" name="heroId" value="1" />
  </form>
  <form class="spellCast" action="/firebolt" method="post" style="display: none;">
    <button id="firebolt" class="btn btn-secondary" type="submit" data-effect="Deals 30 damage and ignores armor">Firebolt</button>
    <input type="hidden" name="heroId" value="1" />
  </form>
  <form class="spellCast" action="/deathray" method="post" style="display: none;">
    <button id="death_ray" class="btn btn-secondary" type="submit" data-effect="Deals 100 damage and ignores armor">Death Ray</button>
    <input type="hidden" name="heroId" value="1" />
  </form>
  <form id="fight" class="btn btn-secondary" action="/fight" method="post">
    <input type="hidden" name="startingBonus" value="${startingBonus}" />
    <input type="hidden" name="heroId" th:value="${hero.id}">
    <input type="hidden" name="enemyId" th:if="${enemy != null}" th:value="${enemy.id}">
    <input type="submit" value="Fight!" th:if="${enemy != null}" style="cursor: url(https://cur.cursors-4u.net/games/gam-4/gam376.cur), auto !important;">
  </form>
</div>
<div class="hero-container">
  <h2><span th:text="${hero.name}"></span></h2>
  <p>Health: <span th:text="${hero.health}"></span> / <span th:text="${hero.maxHealth}"></span></p>
  <p>Attack: <span th:text="${hero.attack}"></span></p>
  <p>Defense: <span th:text="${hero.defense}"></span></p>
  <p>Mana: <span th:text="${hero.mana}"></span></p>
  <p>Healing potion: <span th:text="${hero.potion}"></span></p>
</div>
<div class="enemy-container" th:if="${enemy != null}">
  <h2><span th:text="${enemy.name}"></span></h2>
  <p>Health: <span th:text="${enemy.health} + '/' + ${enemy.maxHealth}"></span></p>
  <p>Attack: <span th:text="${enemy.attack}"></span></p>
  <p>Defense: <span th:text="${enemy.defence}"></span></p>
  <div class="enemy-info-btn">
    <button type="button" class="btn btn-secondary" id="showInfoBtn">Show Info</button>
    <div class="enemy-info">
      <p th:text="${enemy.info}"></p>
      <div id="enemy-pictures">
        <img class="enemy-picture" id="figurine" src="/images/figurine.jpg" alt="dummy" style="display: none; width: 220px; height: 180px;">
        <img class="enemy-picture" id="giant_rat" src="/images/giant_rat.png" alt="rat" style="display: none; width: 225px; height: 185px;">
        <img class="enemy-picture" id="goblin" src="/images/goblin.jpg" alt="goblin" style="display: none; width: 160px; height: 230px;">
        <img class="enemy-picture" id="orc" src="/images/orc.jpeg" alt="orc" style="display: none; width: 160px; height: 230px;">
        <img class="enemy-picture" id="troll" src="/images/troll.jpg" alt="troll" style="display: none; width: 205px; height: 230px;">
        <img class="enemy-picture" id="drake" src="/images/drake.jpg" alt="drake" style="display: none; width: 220px; height: 180px;">
        <img class="enemy-picture" id="minotaur" src="/images/minotaur.png" alt="minotaur" style="display: none; width: 160px; height: 230px;">
        <img class="enemy-picture" id="behemoth" src="/images/behemoth.jpg" alt="behemoth" style="display: none; width: 220px; height: 180px;">
        <img class="enemy-picture" id="medusa" src="/images/medusa.png" alt="medusa" style="display: none; width: 200px; height: 230px;">
        <img class="enemy-picture" id="lich" src="/images/lich.jpg" alt="lich" style="display: none; width: 170px; height: 230px;">
        <img class="enemy-picture" id="dragon" src="/images/dragon.png" alt="dragon" style="display: none; width: 220px; height: 180px;">
      </div>
    </div>
  </div>
</div>
<div class="results">
  <h2>Results:</h2>
  <p id="fightResultP" th:text="${healMessage}"></p>
  <p id="fightResult" th:text="${fightResult}"></p>
  <p id="fightResultH" th:text="${heroAttackMessage}"></p>
  <p id="fightResultE" th:text="${enemyAttackMessage}"></p>
  <p id="fightResultES" th:text="${enemySpecialAttackMessage}"></p>
  <p id="fightResultIH" th:text="${ineffectiveHeroAttackMessage}"></p>
  <p id="fightResultIE" th:text="${ineffectiveEnemyAttackMessage}"></p>
  <p id="fightResultS" th:text="${spellCastingResult}"></p>
  <p th:if="${stolenGold}">Goblin stole <span th:text="${stolenGold}"></span> gold from you!</p>
</div>
</body>
</html>

<script th:inline="javascript">
  document.addEventListener('DOMContentLoaded', function() {
    /* Check if heroLost flag is true (hero has lost) and disable the buttons */
    var heroLost = /*[[${heroLost}]]*/ false; // Get the actual value from the model

    if (heroLost) {
      var buttons = document.querySelectorAll('button[type="submit"]');
      buttons.forEach(function(button) {
        button.disabled = true;
      });
      var fightForm = document.getElementById('fight');
      if (fightForm) {
        var fightButton = fightForm.querySelector('input[type="submit"]');
        if (fightButton) {
          fightButton.disabled = true;
        }
      }
    }

    const showInfoBtn = document.getElementById('showInfoBtn');
    const enemyInfo = document.querySelector('.enemy-info');
    const enemyPictures = document.getElementById('enemy-pictures');
    const enemyName = /*[[${enemy.name}]]*/ ''; // Get the enemy name from the model

    showInfoBtn.addEventListener('mouseover', function() {
      const imageId = enemyName.replace(' ', '_').toLowerCase();
      const image = enemyPictures.querySelector(`#${imageId}`);
      if (image) {
        image.style.display = 'block';
      }
    });

    showInfoBtn.addEventListener('mouseout', function() {
      const imageId = enemyName.replace(' ', '_').toLowerCase();
      const image = enemyPictures.querySelector(`#${imageId}`);
      if (image) {
        image.style.display = 'none';
      }
    });

    showInfoBtn.addEventListener('click', function() {
        enemyInfo.classList.toggle('active');
    });
  });

  const buttons = document.querySelectorAll('.btn-secondary[data-effect]');
  const tooltip = document.createElement('div');
  tooltip.classList.add('tooltip');
  document.body.appendChild(tooltip);

  buttons.forEach(button => {
    button.addEventListener('mouseover', function(e) {
      const effect = e.target.getAttribute('data-effect');
      tooltip.innerText = effect;
      tooltip.style.top = `${e.clientY + 12}px`;
      tooltip.style.left = `${e.clientX + 18}px`;
      tooltip.style.display = 'block';
    });

    button.addEventListener('mouseout', function() {
      tooltip.style.display = 'none';
    });
  });

  function toggleFormVisibility() {
    const spellForms = document.querySelectorAll('.spellCast');
    spellForms.forEach(form => {
      form.style.display = form.style.display === 'none' ? 'block' : 'none';
    });
  }
</script>
</body>
</html>